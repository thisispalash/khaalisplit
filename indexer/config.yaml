# yaml-language-server: $schema=./node_modules/envio/evm.schema.json
name: khaaliSplit
description: "Envio HyperIndex indexer for khaaliSplit contracts"
ecosystem: evm
unordered_multichain_mode: true

field_selection:
  transaction_fields:
    - hash

contracts:
  # ── Sepolia-only contracts ────────────────────────
  - name: khaaliSplitFriends
    abi_file_path: abis/khaaliSplitFriends.json
    handler: src/EventHandlers.ts
    events:
      - event: PubKeyRegistered(address indexed user, bytes pubKey)
      - event: FriendRequested(address indexed from, address indexed to)
      - event: FriendAccepted(address indexed user, address indexed friend)
      - event: FriendRemoved(address indexed user, address indexed friend)

  - name: khaaliSplitGroups
    abi_file_path: abis/khaaliSplitGroups.json
    handler: src/EventHandlers.ts
    events:
      - event: GroupCreated(uint256 indexed groupId, address indexed creator, bytes32 nameHash)
      - event: MemberInvited(uint256 indexed groupId, address indexed inviter, address indexed invitee)
      - event: MemberAccepted(uint256 indexed groupId, address indexed member)
      - event: MemberLeft(uint256 indexed groupId, address indexed member)

  - name: khaaliSplitExpenses
    abi_file_path: abis/khaaliSplitExpenses.json
    handler: src/EventHandlers.ts
    events:
      - event: ExpenseAdded(uint256 indexed groupId, uint256 indexed expenseId, address indexed creator, bytes32 dataHash, bytes encryptedData)
      - event: ExpenseUpdated(uint256 indexed groupId, uint256 indexed expenseId, address indexed creator, bytes32 dataHash, bytes encryptedData)

  - name: khaaliSplitSubnames
    abi_file_path: abis/khaaliSplitSubnames.json
    handler: src/EventHandlers.ts
    events:
      - event: SubnameRegistered(bytes32 indexed node, string label, address indexed owner)
      - event: TextRecordSet(bytes32 indexed node, string key, string value)
      - event: AddrRecordSet(bytes32 indexed node, address addr)
      - event: BackendUpdated(address indexed newBackend)
      - event: ReputationContractUpdated(address indexed newReputationContract)

  - name: khaaliSplitReputation
    abi_file_path: abis/khaaliSplitReputation.json
    handler: src/EventHandlers.ts
    events:
      - event: ReputationUpdated(address indexed user, uint256 newScore, bool wasSuccess)
      - event: UserNodeSet(address indexed user, bytes32 indexed node)
      - event: BackendUpdated(address indexed newBackend)
      - event: SubnameRegistryUpdated(address indexed newSubnameRegistry)
      - event: SettlementContractUpdated(address indexed newSettlementContract)

  - name: khaaliSplitResolver
    abi_file_path: abis/khaaliSplitResolver.json
    handler: src/EventHandlers.ts
    events:
      - event: SignerAdded(address indexed signer)
      - event: SignerRemoved(address indexed signer)
      - event: UrlUpdated(string newUrl)

  - name: kdioDeployer
    abi_file_path: abis/kdioDeployer.json
    handler: src/EventHandlers.ts
    events:
      - event: Deployed(address indexed proxy, bytes32 indexed salt, address indexed implementation)

  # ── Multi-chain contract ──────────────────────────
  - name: khaaliSplitSettlement
    abi_file_path: abis/khaaliSplitSettlement.json
    handler: src/EventHandlers.ts
    events:
      - event: SettlementCompleted(address indexed sender, address indexed recipient, address token, uint256 amount, uint256 senderReputation, bytes memo)
      - event: TokenAdded(address indexed token)
      - event: TokenRemoved(address indexed token)
      - event: TokenMessengerUpdated(address indexed newTokenMessenger)
      - event: GatewayWalletUpdated(address indexed newGatewayWallet)
      - event: GatewayMinterUpdated(address indexed newGatewayMinter)
      - event: DomainConfigured(uint256 indexed chainId, uint32 domain)
      - event: SubnameRegistryUpdated(address indexed newSubnameRegistry)
      - event: ReputationContractUpdated(address indexed newReputationContract)

networks:
  # ── Sepolia: all contracts ────────────────────────
  - id: 11155111
    start_block: 10215968
    contracts:
      - name: khaaliSplitFriends
        address: "0xc6513216d6Bc6498De9E37e00478F0Cb802b2561"
      - name: khaaliSplitGroups
        address: "0xf6f07Bdc4f14b1FB1374A1d821A9E50547EcE820"
      - name: khaaliSplitExpenses
        address: "0x0058f47e98DF066d34f70EF231AdD634C9857605"
      - name: khaaliSplitSettlement
        address: "0xd038e9CD05a71765657Fd3943d41820F5035A6C1"
      - name: khaaliSplitSubnames
        address: "0xE7F20a2c7461cAF3FdCD672E273326fAeCE5Be4F"
      - name: khaaliSplitReputation
        address: "0x3a916C1cb55352860FA46084EBA5A032dB50312f"
      - name: khaaliSplitResolver
        address: "0x7403caAFB6d87d3DFF00ddDA3Ef02ACA13C8364A"
      - name: kdioDeployer
        address: "0x0f04784d0BFaEeFB4bc15C8EbDe4e483ccE2154f"

  # ── Base Sepolia: Settlement only ─────────────────
  - id: 84532
    start_block: 10215968
    contracts:
      - name: khaaliSplitSettlement
        address: "0xacDbabeDc22BE4eD68D9084Dd3157c27D7154baa"

  # ── Arbitrum Sepolia: Settlement only ─────────────
  - id: 421614
    start_block: 10215968
    contracts:
      - name: khaaliSplitSettlement
        address: "0x8A20a346a00f809fbd279c1E8B56883998867254"

  # ── Optimism Sepolia: Settlement only ─────────────
  - id: 11155420
    start_block: 10215968
    contracts:
      - name: khaaliSplitSettlement
        address: "0x8A20a346a00f809fbd279c1E8B56883998867254"

  # ── Arc Testnet: Settlement only ──────────────────
  - id: 5042002
    start_block: 10215968
    rpc_config:
      url: "https://rpc.testnet.arc.network"
    contracts:
      - name: khaaliSplitSettlement
        address: "0xeB75548245A9C5a31ABF6Eda7CA16977f3Af3690"
