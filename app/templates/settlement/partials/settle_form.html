{# Manual settlement form â€” for cases where debt simplification isn't used #}
<form id="settle-form" class="p-4 border border-foreground/10 rounded-md space-y-3">
  {% csrf_token %}

  <h3 class="text-sm font-medium text-foreground/60">Manual Settlement</h3>

  <div>
    <label class="block text-sm text-foreground/70 mb-1">Recipient Address</label>
    <input type="text" name="to_address"
      placeholder="0x..."
      class="w-full px-3 py-2 bg-background border border-foreground/20 rounded-md
             text-foreground text-sm placeholder-foreground/40 focus:outline-none
             focus:border-foreground/40 font-mono"
    >
  </div>

  <div class="grid grid-cols-2 gap-3">
    <div>
      <label class="block text-sm text-foreground/70 mb-1">Amount (USDC)</label>
      <input type="number" name="amount"
        placeholder="0.00" step="0.01" min="0.01"
        class="w-full px-3 py-2 bg-background border border-foreground/20 rounded-md
               text-foreground text-sm placeholder-foreground/40 focus:outline-none
               focus:border-foreground/40"
      >
    </div>
    <div>
      <label class="block text-sm text-foreground/70 mb-1">Chain</label>
      <select name="dest_chain"
        class="w-full px-3 py-2 bg-background border border-foreground/20 rounded-md
               text-foreground text-sm focus:outline-none focus:border-foreground/40">
        <option value="11155111">Sepolia</option>
        <option value="8453">Base Sepolia</option>
        <option value="42161">Arbitrum Sepolia</option>
        <option value="43113">Avalanche Fuji</option>
        <option value="11155420">Optimism Sepolia</option>
      </select>
    </div>
  </div>

  <button type="button"
    class="w-full py-2 bg-foreground text-background font-medium rounded-md
           hover:bg-foreground/90 transition-colors cursor-pointer text-sm"
    _="on click
         if not window.walletConnected
           call window.showToast('Connect wallet first', 'error')
           halt
         end
         set formEl to closest <form/>
         set toAddr to formEl.querySelector('[name=to_address]').value
         set amt to formEl.querySelector('[name=amount]').value
         set chain to formEl.querySelector('[name=dest_chain]').value
         if not toAddr or not amt
           call window.showToast('Fill in all fields', 'error')
           halt
         end
         set me.textContent to 'Signing permit...'
         set me.disabled to true
         try
           set result to await window.settleWithPermit(toAddr, amt, {{ group.group_id }}, chain)
           if result and result.hash
             call window.showToast('Settlement submitted!', 'success')
           end
         catch e
           call window.showToast('Failed: ' + e.message, 'error')
         end
         set me.textContent to 'Settle'
         set me.disabled to false
       end"
  >
    Settle
  </button>
</form>
