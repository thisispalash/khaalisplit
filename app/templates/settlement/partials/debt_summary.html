<div class="space-y-3">
  {% if debts %}
    {% for debt in debts %}
    <div class="p-4 border border-foreground/10 rounded-md
                {% if debt.is_payer %}border-red-400/20 bg-red-400/5{% elif debt.is_payee %}border-green-400/20 bg-green-400/5{% endif %}"
      id="debt-{{ forloop.counter }}">
      <div class="flex items-center justify-between">
        <div class="flex-1">
          <div class="flex items-center gap-2 text-sm">
            <span class="font-medium {% if debt.is_payer %}text-red-400{% endif %}">
              {{ debt.from_subname }}
            </span>
            <span class="text-foreground/30">&rarr;</span>
            <span class="font-medium {% if debt.is_payee %}text-green-400{% endif %}">
              {{ debt.to_subname }}
            </span>
          </div>
          <div class="text-xs text-foreground/40 mt-1">
            <span class="font-mono">{{ debt.from_address|truncatechars:14 }}</span>
            &rarr;
            <span class="font-mono">{{ debt.to_address|truncatechars:14 }}</span>
          </div>
        </div>
        <div class="text-right">
          <span class="font-mono font-medium">{{ debt.amount }} USDC</span>
          {% if debt.is_payer %}
          <div class="mt-1">
            <button
              class="px-3 py-1.5 text-xs bg-foreground text-background rounded-md
                     hover:bg-foreground/90 transition-colors cursor-pointer"
              _="on click
                   if not window.walletConnected
                     call window.showToast('Connect wallet first', 'error')
                     halt
                   end
                   set me.textContent to 'Signing...'
                   set me.disabled to true
                   try
                     set result to await window.settleWithPermit(
                       '{{ debt.to_address }}',
                       '{{ debt.amount }}',
                       {{ group.group_id }}
                     )
                     if result and result.hash
                       call window.showToast('Settlement submitted!', 'success')
                       set target to closest <div/> to me
                       set target.innerHTML to '<p class=\"text-sm text-foreground/50\">Tx: ' + result.hash.substring(0, 14) + '...</p>'
                     end
                   catch e
                     call window.showToast('Settlement failed: ' + e.message, 'error')
                     set me.textContent to 'Pay'
                     set me.disabled to false
                   end
                 end"
            >
              Pay
            </button>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  {% else %}
    <div class="p-4 border border-foreground/10 rounded-md text-center">
      <p class="text-foreground/50 text-sm">All settled up!</p>
      <p class="text-foreground/30 text-xs mt-1">No outstanding debts in this group.</p>
    </div>
  {% endif %}
</div>
