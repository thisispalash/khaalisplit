{% comment %}
  lenses/settlement-card.html â€” Settlement status with HTMX polling
  Context:
    settlement : settlement object (.tx_hash, .status, .from_user, .to_user,
                 .from_address, .to_address, .amount, .token, .created_at)
  Replaces: settlement/partials/settlement_status.html
  Composes: quanta/badge.html, quanta/address.html, quanta/amount.html
  Preserves: HTMX polling for pending/bridging settlements
{% endcomment %}

<div class="p-3 border border-border rounded-md"
  id="settlement-{{ settlement.tx_hash }}"
  {% if settlement.status == 'submitted' or settlement.status == 'bridging' %}
    hx-get="/api/settle/status/{{ settlement.tx_hash }}/"
    hx-trigger="every 5s"
    hx-swap="outerHTML"
  {% endif %}
>
  <div class="flex items-center justify-between">
    <div class="flex-1 min-w-0">
      <div class="flex items-center gap-2">
        <span class="font-mono text-xs truncate">{{ settlement.tx_hash|truncatechars:18 }}</span>
        {% if settlement.status == 'pending' %}
          {% include 'quanta/badge.html' with status='pending' label='Pending' %}
        {% elif settlement.status == 'submitted' %}
          {% include 'quanta/badge.html' with status='submitted' label='Submitted' %}
        {% elif settlement.status == 'bridging' %}
          {% include 'quanta/badge.html' with status='bridging' label='Bridging' %}
        {% elif settlement.status == 'confirmed' %}
          {% include 'quanta/badge.html' with status='confirmed' label='Confirmed' %}
        {% elif settlement.status == 'failed' %}
          {% include 'quanta/badge.html' with status='failed' label='Failed' %}
        {% endif %}
      </div>
      <div class="text-xs text-subtle mt-1">
        {{ settlement.from_user.subname|default:settlement.from_address|truncatechars:10 }}
        &rarr;
        {{ settlement.to_user.subname|default:settlement.to_address|truncatechars:10 }}
      </div>
    </div>
    <div class="text-right ml-3">
      {% include 'quanta/amount.html' with value=settlement.amount token=settlement.token %}
      <div class="text-xs text-subtle">{{ settlement.created_at|timesince }} ago</div>
    </div>
  </div>
</div>
