{% comment %}
  partials/payment_preferences.html â€” Payment preferences card (HTMX swappable)

  Context:
    payment_flow  : string ("gateway" or "authorization")
    payment_chain : string (chain ID, e.g. "11155111")
    payment_token : string (USDC address)
    chain_options : list of (value, display) tuples
    has_wallet    : bool
    editing       : bool (whether to show edit form)
{% endcomment %}

<div id="payment-prefs" class="space-y-3 pt-4 border-t border-border">
  <div class="flex items-center justify-between">
    <h2 class="text-sm font-medium text-muted">Payment Preferences</h2>
    {% if has_wallet and not editing %}
      {% include 'quanta/button.html' with variant='ghost' size='sm' label='Edit' extra_attrs='hx-get="/api/profile/payment-preferences/?edit=1" hx-target="#payment-prefs" hx-swap="outerHTML"' %}
    {% endif %}
  </div>

  {% if not has_wallet %}
    <p class="text-subtle text-sm">Link a wallet to configure payment preferences.</p>
  {% elif editing %}
    {# Edit form #}
    <form
      hx-post="/api/profile/payment-preferences/"
      hx-target="#payment-prefs"
      hx-swap="outerHTML"
      class="space-y-3"
    >
      {% csrf_token %}

      {% include 'quanta/select.html' with name='payment_flow' label='Settlement flow' options=flow_options selected=payment_flow %}
      {% include 'quanta/select.html' with name='payment_chain' label='Preferred chain' options=chain_options selected=payment_chain %}

      <div class="flex gap-2">
        {% include 'quanta/button.html' with variant='primary' size='sm' type='submit' label='Save' %}
        {% include 'quanta/button.html' with variant='ghost' size='sm' label='Cancel' extra_attrs='hx-get="/api/profile/payment-preferences/" hx-target="#payment-prefs" hx-swap="outerHTML"' %}
      </div>
    </form>
  {% else %}
    {# Read-only display #}
    <div class="grid grid-cols-2 gap-2 text-sm">
      <div>
        <span class="text-subtle">Flow</span>
        <p class="font-medium">{{ payment_flow|default:"gateway"|title }}</p>
      </div>
      <div>
        <span class="text-subtle">Chain</span>
        <p class="font-medium">{{ chain_display|default:"Sepolia" }}</p>
      </div>
      {% if payment_token %}
      <div class="col-span-2">
        <span class="text-subtle">Token</span>
        <p class="font-mono text-xs">USDC ({{ payment_token|truncatechars:14 }})</p>
      </div>
      {% endif %}
    </div>
  {% endif %}
</div>
