<form id="expense-form"
  hx-post="/api/expenses/{{ group.group_id }}/add/"
  hx-target="#expense-list"
  hx-swap="innerHTML"
  class="p-4 border border-foreground/10 rounded-md space-y-3"
>
  {% csrf_token %}

  {% if form.non_field_errors %}
  <div class="text-red-400 text-sm border border-red-700/50 bg-red-900/20 px-3 py-2 rounded-md">
    {% for error in form.non_field_errors %}
      <p>{{ error }}</p>
    {% endfor %}
  </div>
  {% endif %}

  <div>
    <label class="block text-sm text-foreground/70 mb-1">Description</label>
    {{ form.description }}
    {% if form.description.errors %}
      <p class="text-red-400 text-xs mt-1">{{ form.description.errors.0 }}</p>
    {% endif %}
  </div>

  <div class="grid grid-cols-2 gap-3">
    <div>
      <label class="block text-sm text-foreground/70 mb-1">Amount</label>
      {{ form.amount }}
      {% if form.amount.errors %}
        <p class="text-red-400 text-xs mt-1">{{ form.amount.errors.0 }}</p>
      {% endif %}
    </div>
    <div>
      <label class="block text-sm text-foreground/70 mb-1">Split</label>
      {{ form.split_type }}
    </div>
  </div>

  <div>
    <label class="block text-sm text-foreground/70 mb-1">Category</label>
    {{ form.category }}
  </div>

  {{ form.encrypted_data }}
  {{ form.data_hash }}

  <button type="submit"
    class="w-full py-2 bg-foreground text-background font-medium rounded-md
           hover:bg-foreground/90 transition-colors cursor-pointer text-sm"
    _="on click
         if window.khaaliCrypto and window.khaaliCrypto.groupKey
           set formEl to closest <form/>
           set desc to formEl.querySelector('[name=description]').value
           set amt to formEl.querySelector('[name=amount]').value
           set cat to formEl.querySelector('[name=category]').value
           set splitType to formEl.querySelector('[name=split_type]').value
           set plaintext to JSON.stringify({description: desc, amount: amt, category: cat, split_type: splitType})
           set result to await window.khaaliCrypto.encrypt(plaintext)
           set formEl.querySelector('[name=encrypted_data]').value to result.ciphertext
           set formEl.querySelector('[name=data_hash]').value to result.hash
         end
       end"
  >
    Add Expense
  </button>
</form>
