# khaaliSplit
#
# Profiles:
#   dev  :: bind mount + dev server + host port 8002
#   prod :: baked image, internal only (accessed through nginx)
#
# Usage:
#   COMPOSE_PROFILES=dev docker compose up -d
#   COMPOSE_PROFILES=prod docker compose up -d

services:

  # ---------------- dev ----------------------------------------------------- #
  khaaliSplit-dev:
    container_name: khaaliSplit_dev
    build: .
    command: make dev
    environment:
      - DEBUG=true
    env_file:
      - .env
    volumes:
      - .:/app
    ports:
      - "8002:8000"
    networks:
      - kdio_network
    profiles:
      - dev

  # ---------------- prod ---------------------------------------------------- #
  khaaliSplit:
    container_name: khaaliSplit
    build: .
    command: make prod
    restart: always
    environment:
      - DEBUG=false
    env_file:
      - .env
    volumes:
      - khaaliSplit_static:/app/static
    networks:
      - kdio_network
    profiles:
      - prod

networks:
  kdio_network:
    external: true

volumes:
  khaaliSplit_static:
